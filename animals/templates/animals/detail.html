{% extends 'animals/base.html' %}

{% block title %}{{ animal.name }} - PawShelter{% endblock %}

{% block extra_css %}
<style>
    .animal-detail {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 15px;
        padding: 2rem;
        box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        margin-bottom: 2rem;
    }
    
    .animal-header {
        display: flex;
        gap: 2rem;
        margin-bottom: 2rem;
        flex-wrap: wrap;
    }
    
    .animal-photos {
        flex: 1;
        min-width: 300px;
    }
    
    .main-photo {
        width: 100%;
        border-radius: 15px;
        object-fit: cover;
        height: 400px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        margin-bottom: 1rem;
    }
    
    .photo-gallery {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
        gap: 0.5rem;
    }
    
    .gallery-thumb {
        width: 100%;
        height: 100px;
        object-fit: cover;
        border-radius: 8px;
        cursor: pointer;
        transition: transform 0.3s;
    }
    
    .gallery-thumb:hover {
        transform: scale(1.1);
    }
    
    .animal-info {
        flex: 1;
        min-width: 300px;
    }
    
    .animal-name {
        font-size: 2.5rem;
        color: #667eea;
        margin-bottom: 1rem;
    }
    
    .animal-meta {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
        margin-bottom: 1.5rem;
    }
    
    .meta-item {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    
    .meta-label {
        font-weight: bold;
        color: #666;
        min-width: 120px;
    }
    
    .meta-value {
        color: #333;
    }
    
    .status-badge {
        display: inline-block;
        padding: 0.3rem 0.8rem;
        border-radius: 15px;
        font-size: 0.9rem;
        font-weight: bold;
    }
    
    .status-in-shelter {
        background: #d4edda;
        color: #155724;
    }
    
    .status-adopted {
        background: #f8d7da;
        color: #721c24;
    }
    
    .animal-description {
        margin-top: 2rem;
        padding-top: 2rem;
        border-top: 2px solid #e0e0e0;
    }
    
    .animal-description h3 {
        color: #667eea;
        margin-bottom: 1rem;
    }
    
    .adoption-section {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 15px;
        padding: 2rem;
        box-shadow: 0 5px 20px rgba(0,0,0,0.2);
    }
    
    .adoption-form {
        margin-top: 1.5rem;
    }
    
    .form-group {
        margin-bottom: 1.5rem;
    }
    
    .form-group label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: bold;
        color: #333;
    }
    
    .form-group input[type="text"],
    .form-group textarea {
        width: 100%;
        padding: 0.8rem;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        font-size: 1rem;
        font-family: inherit;
    }
    
    .form-group input:focus,
    .form-group textarea:focus {
        outline: none;
        border-color: #667eea;
    }
    
    .form-group textarea {
        min-height: 100px;
        resize: vertical;
    }
    
    .form-group input[type="checkbox"] {
        width: auto;
        margin-right: 0.5rem;
    }
    
    .form-group label[for] {
        cursor: pointer;
    }
    
    .adoption-status {
        padding: 1rem;
        border-radius: 8px;
        margin-bottom: 1rem;
    }
    
    .adoption-status.pending {
        background: #fff3cd;
        color: #856404;
        border: 1px solid #ffeaa7;
    }
    
    .adoption-status.approved {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
    }
    
    .adoption-status.rejected {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
    }
    
    .back-link {
        display: inline-block;
        margin-bottom: 1rem;
        color: white;
        text-decoration: none;
        padding: 0.5rem 1rem;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 8px;
        transition: background 0.3s;
    }
    
    .back-link:hover {
        background: rgba(255, 255, 255, 0.3);
    }
</style>
{% endblock %}

{% block content %}
<a href="{% url 'animal_list' %}" class="back-link">‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É</a>

<div class="animal-detail">
    <div class="animal-header">
        <div class="animal-photos">
            {% if photos %}
                <img src="{{ photos.0.photo_url.url }}" alt="{{ animal.name }}" class="main-photo" id="mainPhoto">
                {% if photos|length > 1 %}
                    <div class="photo-gallery">
                        {% for photo in photos %}
                            <img src="{{ photo.photo_url.url }}" alt="{{ animal.name }}" class="gallery-thumb" onclick="changeMainPhoto('{{ photo.photo_url.url }}')">
                        {% endfor %}
                    </div>
                {% endif %}
            {% else %}
                <div class="main-photo"></div>
            {% endif %}
        </div>
        
        <div class="animal-info">
            <h1 class="animal-name">{{ animal.name }}</h1>
            <div class="animal-meta">
                <div class="meta-item">
                    <span class="meta-label">–í–∏–¥:</span>
                    <span class="meta-value">{{ animal.species }}</span>
                </div>
                {% if animal.breed %}
                <div class="meta-item">
                    <span class="meta-label">–ü–æ—Ä–æ–¥–∞:</span>
                    <span class="meta-value">{{ animal.breed }}</span>
                </div>
                {% endif %}
                <div class="meta-item">
                    <span class="meta-label">–í–æ–∑—Ä–∞—Å—Ç:</span>
                    <span class="meta-value">
                        {% if animal.age_years > 0 %}
                            {{ animal.age_years }}
                            {% if animal.age_years == 1 or animal.age_years == 21 or animal.age_years == 31 or animal.age_years == 41 or animal.age_years == 51 or animal.age_years == 61 or animal.age_years == 71 or animal.age_years == 81 or animal.age_years == 91 %}–≥–æ–¥
                            {% elif animal.age_years >= 2 and animal.age_years <= 4 or animal.age_years >= 22 and animal.age_years <= 24 or animal.age_years >= 32 and animal.age_years <= 34 or animal.age_years >= 42 and animal.age_years <= 44 or animal.age_years >= 52 and animal.age_years <= 54 or animal.age_years >= 62 and animal.age_years <= 64 or animal.age_years >= 72 and animal.age_years <= 74 or animal.age_years >= 82 and animal.age_years <= 84 or animal.age_years >= 92 and animal.age_years <= 94 %}–≥–æ–¥–∞
                            {% else %}–ª–µ—Ç{% endif %}
                        {% endif %}
                        {% if animal.age_years > 0 and animal.age_months > 0 %}, {% endif %}
                        {% if animal.age_months > 0 %}
                            {{ animal.age_months }}
                            {% if animal.age_months == 1 or animal.age_months == 21 or animal.age_months == 31 %}–º–µ—Å—è—Ü
                            {% elif animal.age_months >= 2 and animal.age_months <= 4 or animal.age_months >= 22 and animal.age_months <= 24 or animal.age_months >= 32 and animal.age_months <= 34 %}–º–µ—Å—è—Ü–∞
                            {% else %}–º–µ—Å—è—Ü–µ–≤{% endif %}
                        {% endif %}
                    </span>
                </div>
                <div class="meta-item">
                    <span class="meta-label">–°—Ç–∞—Ç—É—Å:</span>
                    <span class="status-badge {% if animal.status == 'in_shelter' %}status-in-shelter{% else %}status-adopted{% endif %}">
                        {{ animal.get_status_display }}
                    </span>
                </div>
            </div>
            
            <div class="animal-description">
                <h3>–û –∑–¥–æ—Ä–æ–≤—å–µ</h3>
                <p>{{ animal.health_status }}</p>
                {% if animal.description %}
                    <h3 style="margin-top: 1.5rem;">–û–ø–∏—Å–∞–Ω–∏–µ</h3>
                    <p>{{ animal.description }}</p>
                {% endif %}
            </div>
            
            {% if user.is_authenticated %}
                {% if user.role == 'admin' or user.role == 'volunteer' %}
                    <div style="margin-top: 2rem; padding-top: 2rem; border-top: 2px solid #e0e0e0; display: flex; gap: 1rem;">
                        <a href="{% url 'edit_animal' animal.slug %}" class="btn btn-primary">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
                        <a href="{% url 'delete_animal' animal.slug %}" class="btn btn-danger" onclick="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ –∂–∏–≤–æ—Ç–Ω–æ–µ? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!')">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</a>
                    </div>
                {% endif %}
            {% endif %}
        </div>
    </div>
</div>

{% if user.is_authenticated %}
    {% if user.role == 'adopter' %}
        <div class="adoption-section">
            <h2 style="color: #667eea; margin-bottom: 1rem;">–ü–æ–¥–∞—Ç—å –∑–∞—è–≤–∫—É –Ω–∞ —É—Å—ã–Ω–æ–≤–ª–µ–Ω–∏–µ</h2>
            
            {% if has_adoption %}
                <div class="adoption-status {{ existing_adoption.status }}">
                    <strong>–£ –≤–∞—Å —É–∂–µ –µ—Å—Ç—å –∑–∞—è–≤–∫–∞ –Ω–∞ —ç—Ç–æ –∂–∏–≤–æ—Ç–Ω–æ–µ</strong><br>
                    –°—Ç–∞—Ç—É—Å: <strong>{{ existing_adoption.get_status_display }}</strong><br>
                    –î–∞—Ç–∞ –ø–æ–¥–∞—á–∏: {{ existing_adoption.submitted_at|date:"d.m.Y H:i" }}<br>
                    {% if existing_adoption.status == 'rejected' and existing_adoption.rejection_reason %}
                        <div style="margin-top: 0.5rem; padding: 0.5rem; background: rgba(248, 215, 218, 0.3); border-radius: 5px;">
                            <strong>–ü—Ä–∏—á–∏–Ω–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è:</strong> {{ existing_adoption.rejection_reason }}
                        </div>
                    {% elif existing_adoption.status == 'approved' %}
                        <div style="margin-top: 0.5rem; padding: 0.5rem; background: rgba(212, 237, 218, 0.3); border-radius: 5px;">
                            <strong>üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º!</strong> –í–∞—à–∞ –∑–∞—è–≤–∫–∞ –æ–¥–æ–±—Ä–µ–Ω–∞. –ñ–∏–≤–æ—Ç–Ω–æ–µ {{ animal.name }} —Ç–µ–ø–µ—Ä—å –≤–∞—à–µ!
                        </div>
                    {% elif existing_adoption.status == 'pending' %}
                        <div style="margin-top: 0.5rem; padding: 0.5rem; background: rgba(255, 243, 205, 0.3); border-radius: 5px;">
                            –í–∞—à–∞ –∑–∞—è–≤–∫–∞ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –Ω–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏. –û–∂–∏–¥–∞–π—Ç–µ —Ä–µ—à–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.
                        </div>
                    {% endif %}
                </div>
            {% elif animal.status != 'in_shelter' %}
                <div class="adoption-status adopted">
                    –≠—Ç–æ –∂–∏–≤–æ—Ç–Ω–æ–µ —É–∂–µ —É—Å—ã–Ω–æ–≤–ª–µ–Ω–æ
                </div>
            {% else %}
                <form method="post" class="adoption-form">
                    {% csrf_token %}
                    <p><strong>–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –ø–æ–¥–∞—Ç—å –∑–∞—è–≤–∫—É –Ω–∞ —É—Å—ã–Ω–æ–≤–ª–µ–Ω–∏–µ {{ animal.name }}?</strong></p>
                    
                    <h3 style="color: #667eea; margin-top: 1.5rem; margin-bottom: 1rem;">–ê–Ω–∫–µ—Ç–∞ —É—Å—ã–Ω–æ–≤–∏—Ç–µ–ª—è</h3>
                    
                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                            <input type="checkbox" name="has_experience" {% if user.has_experience %}checked{% endif %}>
                            <span>–£ –º–µ–Ω—è –µ—Å—Ç—å –æ–ø—ã—Ç —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—è –∂–∏–≤–æ—Ç–Ω—ã—Ö</span>
                        </label>
                    </div>
                    
                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                            <input type="checkbox" name="has_other_pets" {% if user.has_other_pets %}checked{% endif %}>
                            <span>–£ –º–µ–Ω—è –µ—Å—Ç—å –¥—Ä—É–≥–∏–µ –ø–∏—Ç–æ–º—Ü—ã</span>
                        </label>
                    </div>
                    
                    <div class="form-group">
                        <label for="ready_for_pet">–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –ø–∏—Ç–æ–º—Ü—É</label>
                        <textarea id="ready_for_pet" name="ready_for_pet" placeholder="–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –æ —Å–≤–æ–µ–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –ø—Ä–∏–Ω—è—Ç—å –ø–∏—Ç–æ–º—Ü–∞...">{{ user.ready_for_pet|default:'' }}</textarea>
                    </div>
                    
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">–ü–æ–¥–∞—Ç—å –∑–∞—è–≤–∫—É</button>
                    </div>
                </form>
            {% endif %}
        </div>
    {% endif %}
{% else %}
    <div class="adoption-section">
        <p>–î–ª—è –ø–æ–¥–∞—á–∏ –∑–∞—è–≤–∫–∏ –Ω–∞ —É—Å—ã–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ <a href="{% url 'login' %}">–≤–æ–π—Ç–∏</a> –∏–ª–∏ <a href="{% url 'register' %}">–∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a></p>
    </div>
{% endif %}

<script>
    function changeMainPhoto(url) {
        document.getElementById('mainPhoto').src = url;
    }
</script>
{% endblock %}

