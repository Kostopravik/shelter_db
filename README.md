# PawShelter
## Описание
Приложение представляет собой веб-платформу для управления приютом для животных. Пользователи могут просматривать список животных, подавать заявки на усыновление, а администраторы и волонтёры управлять животными и их данными. Система поддерживает роли пользователей с гибкой моделью контроля доступа RBAC (role-based access control).

Функционал включает:
* Животные: добавление, редактирование и удаление животных; отслеживание здоровья, возраста и статуса; прикрепление фотографий.
* Заявки на усыновление: подача, просмотр и управление статусом заявок (ожидает, одобрено, отклонено); возможность оформления возврата животного при неудачном усыновлении.
* Активности приюта: создание и ведение ленты событий, включая кормление, лечение, уход за животными, новости и мероприятия; просмотр активностей всеми пользователями; добавление записей только волонтёрами и администраторами.
* Поиск и фильтрация: по виду животного и статусу. 
* Разграничение прав доступа по ролям.


 ## Наименование
 **PawShelter** - название отражает основной функционал приложения: управление приютом для животных и процессом усыновления.

 ## Предметная область
 Система предназначена для учета животных в приюте, управления пользователями с различными ролями, ведения заявок на усыновление и ленты событий приюта. Основные сущности: пользователи, животные, заявки, фотографии животных, активности приюта. Система обеспечивает контроль за животными, прозрачность процесса усыновления и разграничение прав доступа.

 ## Данные
 ### Пользователь:
* Имя (username) - обязательное, уникальное
* Email (email) - обязательное, уникальное, корректный формат
* Пароль (password) - обязательное, захэшированное
* Роль (role) - admin, volunteer, adopter; по умолчанию adopter
* Дата регистрации (created_at) - автоматически
* Анкета усыновителя (только для роли adopter):
  - Опыт содержания животных (has_experience) — да/нет, необязательное  
  - Другие питомцы (has_other_pets) — да/нет, необязательное  
  - Готовность к питомцу (ready_for_pet) — короткий текст  
* После авторизации пользователь может выполнять действия в зависимости от своей роли.
### Животные:
* Имя (name) - обязательное
* Вид (species) - обязательное, например кошка, собака
* Порода (breed) - не обязательно. 
* Возраст (age) - обязательное, ≥ 0
* Описание здоровья (health_status) - обязательное
* Статус (status) - обязательное, in_shelter или adopted
* Дата добавления (created_at) - автоматически
### Заявки на усыновление:
* Пользователь (user_id) - ссылка на пользователя
* Животное (animal_id) - ссылка на животное
* Статус (status) - pending, approved, rejected, returned; по умолчанию pending
* Дата подачи (submitted_at) - автоматически
* Причина отклонения (rejection_reason) — текстовое поле, обязательное

### Фотографии животных:
* Животное (animal_id) - ссылка на животное
* URL фотографии (photo_url) - обязательное
* Дата загрузки (uploaded_at) - автоматически
### Активности приюта:
Записи о событиях и активности приюта представляют собой хронологические записи действий и мероприятий, связанных с уходом за животными и жизнью приюта.  
Примеры записей: кормление, медицинский осмотр, уборка, новости, советы по уходу, различные мероприятия. 
* Название (title) - обязательное
* Описание (description) - обязательное
* Тип (activity_type) - обязательное
* Создатель (created_by) - обязательная ссылка на пользователя, который создал запись
* Опциональное фото (photo_url) - URL или путь к фотографии активности
* Дата создания (created_at) - автоматически подставляется при создании записи
### Возвраты животных (Returns):
Возвраты фиксируют случаи, когда усыновление не состоялось или животное было возвращено в приют.
* Усыновление (adoption_id) — ссылка на заявку, по которой было одобрено усыновление
* Причина возврата (reason) — текстовое поле, обязательное
* Дата возврата (returned_at) — автоматически

  
При возврате:
 - Заявка получает статус returned
 - Животное переводится в статус in_shelter
 - Животное снова становится доступным для усыновления
  
# Для каждого элемента данных - ограничения:
* Имя пользователя (username) - уникальное
* Email пользователя (email) - уникальный и корректный
* Пароль (password) - минимум 6 символов, должна быть хотя бы одна заглавная буква
* Анкета усыновителя (для роли adopter):
  - has_experience — да/нет, необязательное
  - has_other_pets — да/нет, необязательное
  - ready_for_pet — текстовое поле, необязательное
* Имя животного (name) - обязательное
* Возраст животного (age) - ≥ 0
* Статус животного (status) - только in_shelter или adopted
* Заявка на усыновление:
  - Один пользователь не может подать более одной активной заявки на одного и того же питомца
  - При отклонении заявки необходимо указать причину (rejection_reason), обязательное поле
* Фото животных (photo_url) - только форматы .jpg и .png
* Активность приюта (activity_type) - только допустимые типы: feeding, medical, cleaning, event, news, advice
* Создание/редактирование активности - только администраторы и волонтёры
* Просмотр активности - все пользователи

## Установка и запуск проекта локально

- **Клонирование репозитория**
  - Склонируйте проект:
    ```bash
    git clone https://github.com/Kostopravik/shelter_db.git
    cd PawShelter
    ```

- **Создание и активация виртуального окружения (Windows, PowerShell)**
  - Создайте окружение (если ещё не создано):
    ```bash
    python -m venv .venv
    ```
  - Активируйте его:
    ```bash
    .venv\Scripts\Activate.ps1
    ```

- **Установка зависимостей**
  - Установите все пакеты из актуального `requirements.txt`:
    ```bash
    pip install -r requirements.txt
    ```

- **Миграции базы данных**
  - Примените миграции:
    ```bash
    python manage.py migrate
    ```

- **Создание суперпользователя (администратора)**
  - Создайте аккаунт администратора для доступа в админ‑панель:
    ```bash
    python manage.py createsuperuser
    ```
  - После создания можно зайти в админку по адресу `http://127.0.0.1:8000/admin/` и:
    - создавать/редактировать пользователей;
    - выставлять им роли (`admin`, `volunteer`, `adopter`) через модель `CustomUser`.

- **Запуск локального сервера**
  - Запустите Django‑сервер разработки:
    ```bash
    python manage.py runserver
    ```
  - Основной публичный сайт будет доступен по адресу `http://127.0.0.1:8000/`.

- **Запуск тестов**
  - Для запуска всех автоматических тестов используйте встроенный механизм Django:
    ```bash
    python manage.py test
    ```

# Схема баз данных

![Диаграмма базы данных](db_diagram.png)

# Общие ограничения целостности
* Валидация данных - проверка корректности всех полей (уникальность, форматы, диапазоны значений и т.д.)
* Ограничения доступа по ролям - определение, какие действия доступны каждой роли (Admin, Volunteer, Adopter)
* При возврате животного должна сохраняться ссылка на исходную заявку, чтобы отслеживать историю усыновлений.

# Пользовательские роли
### Adopter (усыновитель)
* Просмотр списка животных и информации о них
* Поиск и фильтрация: по виду животного, статусу.
* Подача заявок на усыновление
* Просмотр ленты активностей приюта
### Volunteer (волонтёр)
* Добавление, редактирование и удаление информации о животных
* Загрузка и прикрепление фотографий животных
* Создание и редактирование активностей приюта: feeding, medical, cleaning, event, news, advice
* Просмотр всех записей и ленты активностей
* Просмотр заявок на усыновление
### Admin (администратор)
* Полный доступ ко всем данным и функциям системы
* Управление пользователями: создание, редактирование, удаление
* Контроль и управление активностями приюта
* Просмотр и модерация всей информации

# User stories
### Роль: Усыновитель (Adopter)
* Просматривает список животных и карточки с их описанием, чтобы выбрать питомца для усыновления.
* Может подать заявку только на животное со статусом in_shelter.
* Может заполнять анкету усыновителя с указанием опыта, наличия других питомцев и готовности к животному; эти данные видны администратору при рассмотрении заявки.
* Не может иметь более одной активной заявки на одного и того же питомца.
* Может отслеживать статус своей заявки (pending, approved, rejected).
* В случае, если его заявка одобрена, животное получает статус adopted и становится недоступным для новых заявок.
* Если заявку одобрил другой пользователь, все остальные активные заявки на это животное автоматически переводятся в статус rejected, а карточка животного остаётся доступной только для просмотра.

### Роль: Волонтёр (Volunteer)
* Добавляет и редактирует карточки животных, чтобы поддерживать актуальность информации.
* Прикрепляет фотографии животных.
* Создаёт и редактирует записи о событиях и активности приюта.
* Может просматривать все заявки на усыновление, но не изменять их статус.

### Роль: Администратор (Admin)
* Управляет заявками на усыновление: одобряет или отклоняет их. При отклонении заявки может указать причину отклонения (rejection_reason).
* При одобрении заявки животное автоматически переводится в статус adopted, а все остальные активные заявки на это животное отклоняются.
* При отклонении заявки животное остаётся доступным для других усыновителей.
* Управляет пользователями: создаёт, редактирует и удаляет аккаунты, назначает роли.
* Имеет полный доступ к данным о животных, фотографиям и активности приюта.
* Может оформлять возврат животных в приют (в случае, если усыновление не состоялось). При этом животное переводится в статус in_shelter, а заявка получает статус returned.

# UI / API
Публичный сайт и REST API обеспечивают полный цикл работы с приютом: от просмотра животных и подачи заявок до администрирования базы и ленты активностей.

- **Веб‑интерфейс (UI)**
  - **Публичная часть (без авторизации)**: просмотр списка животных, их карточек, фотографий и ленты активностей приюта.
  - **Усыновитель (Adopter)**:
    - регистрация и вход в систему;
    - просмотр списка животных и подача заявок на усыновление только на животных со статусом `in_shelter`;
    - просмотр своих заявок и их статусов («Мои заявки»);
    - оформление возвратов по уже одобренным заявкам («Мои возвраты») с обязательным указанием причины;
  - **Волонтёр (Volunteer)**:
    - отдельные пункты меню для создания/редактирования животных и активностей;
    - просмотр всех заявок и возвратов (без права менять статус заявок через UI);
    - управление контентом (карточки животных, фотографии, новости, события).
  - **Администратор (Admin)**:
    - полный доступ к заявкам: одобрение/отклонение с обязательной причиной при отклонении;
    - отслеживание возвратов;
    - доступ к административной панели Django (`/admin/`) для управления пользователями и ролями.

- **REST API (Django REST Framework)**
  - **Животные**:
    - `GET /api/animals/` - список животных с фильтрацией по виду и статусу;
    - `POST /api/animals/` - создание животного (только `admin` и `volunteer`);
    - `GET /api/animals/<id>/`, `PUT`, `DELETE` - детальный просмотр и управление (только для сотрудников приюта).
  - **Заявки на усыновление**:
    - `GET /api/adoptions/` - пользователи видят только свои заявки, сотрудники - все;
    - `POST /api/adoptions/` - подача заявки (только авторизованные пользователи);
    - `GET /api/adoptions/<id>/` - просмотр заявки с проверкой прав доступа;
    - `PUT /api/adoptions/<id>/` - изменение статуса заявки (только `admin`, с логикой изменения статусов животных и других заявок);
    - `DELETE /api/adoptions/<id>/` - удаление заявки (только `admin`).
  - **Возвраты**:
    - `GET /api/returns/` - пользователи видят свои возвраты, сотрудники — все;
    - `POST /api/returns/` - создание возврата (через API только для `admin`, с проверками статуса заявки и уникальности возврата).
  - **Пользователи**:
    - `GET /users/api/users/` - администратор видит всех пользователей, остальные — только себя;
    - `POST /users/api/users/` - создание пользователей через API (только `admin`);
    - `GET/PUT/DELETE /users/api/users/<id>/` - детальный просмотр/редактирование/удаление с проверкой прав.

# Технологии разработки

- **Язык программирования**: Python 3.13.1
- **Веб‑фреймворк**: Django 5.x (классические views + шаблоны)
- **API‑слой**: Django REST Framework (создание REST‑эндпоинтов для животных, заявок, возвратов и пользователей)
- **База данных**: SQLite (по умолчанию для локальной разработки; легко заменить на PostgreSQL/MySQL при необходимости)
- **Хранение медиа**: `ImageField` + Pillow (фотографии животных и активности приюта)
- **Аутентификация и авторизация**:
  - кастомная модель пользователя `CustomUser` с полем `role` (`admin`, `volunteer`, `adopter`);
  - разграничение прав на уровне Django‑views и DRF‑эндпоинтов;
  - защита от CSRF для форм в шаблонах.

# Тестирование 

- **Автоматические тесты (Django TestCase)** - запускаются командой `python manage.py test`:
  - **Adoptions** (`adoptions/tests.py`):
    - проверка, что волонтёры не могут одобрять заявки через API, а администратор может изменить статус заявки и животного;
    - проверка оформления возврата: причина возврата обязательна, статусы заявки и животного корректно меняются на `returned` и `in_shelter`;
    - проверка, что оформить возврат может только владелец заявки (даже админ и волонтёр не могут оформить возврат по чужой заявке);
    - проверка наличия в сообщении для пользователя контактного телефона при успешном возврате.
  - **Users** (`users/tests.py`):
    - регистрация нового пользователя с автоматическим назначением роли `adopter` и последующим авто‑логином;
    - проверка входа и выхода из системы через стандартные views;
    - проверка API пользователей: админ видит всех пользователей, обычный пользователь - только себя; не‑админ не может создавать пользователей через API.
  - **Animals** (`animals/tests.py`):
    - проверка, что усыновитель не может создавать животных через API;
    - проверка, что волонтёр может добавить животное через REST‑эндпоинт.
  - **Activities** (`activities/tests.py`):
    - проверка, что обычный пользователь не может создать активность через веб‑форму и получает сообщение о нехватке прав;
    - проверка, что волонтёр может создать активность через API.

- **Тестирование безопасности и доступа**:
  - **Роли Adopter, Volunteer, Admin** проверяются как в шаблонных представлениях, так и в REST‑эндпоинтах:
    - усыновители не могут одобрять заявки, создавать животных и активности;
    - волонтёры могут управлять контентом (животные, активности), но не могут менять статус заявок и пользователей;
    - администраторы имеют расширенные права, но оформление возврата через пользовательский интерфейс привязано к владельцу заявки, чтобы исключить несанкционированные действия.

# Язык программирования
* Python 3.13.1

# СУБД
* SQLite  
