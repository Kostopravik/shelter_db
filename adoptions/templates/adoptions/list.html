{% extends 'animals/base.html' %}

{% block title %}–ó–∞—è–≤–∫–∏ –Ω–∞ —É—Å—ã–Ω–æ–≤–ª–µ–Ω–∏–µ - PawShelter{% endblock %}

{% block extra_css %}
<style>
    .page-header {
        text-align: center;
        color: white;
        margin-bottom: 3rem;
        padding: 2rem 0;
    }
    
    .page-header h1 {
        font-size: 2.5rem;
        margin-bottom: 1rem;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }
    
    .filter-section {
        background: rgba(255, 255, 255, 0.95);
        padding: 1.5rem;
        border-radius: 15px;
        margin-bottom: 2rem;
        box-shadow: 0 5px 20px rgba(0,0,0,0.2);
    }
    
    .filter-form {
        display: flex;
        gap: 1rem;
        align-items: center;
        flex-wrap: wrap;
    }
    
    .filter-form select {
        padding: 0.6rem 1rem;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        font-size: 1rem;
    }
    
    .adoptions-list {
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
    }
    
    .adoption-card {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 15px;
        padding: 1.5rem;
        box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        transition: transform 0.3s;
        color: inherit;
        display: block;
    }
    
    .adoption-card:hover {
        transform: translateY(-3px);
    }
    
    .adoption-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
        flex-wrap: wrap;
        gap: 1rem;
    }
    
    .adoption-title {
        font-size: 1.3rem;
        font-weight: bold;
        color: #667eea;
    }
    
    .status-badge {
        padding: 0.4rem 1rem;
        border-radius: 20px;
        font-size: 0.9rem;
        font-weight: bold;
    }
    
    .status-pending {
        background: #fff3cd;
        color: #856404;
    }
    
    .status-approved {
        background: #d4edda;
        color: #155724;
    }
    
    .status-rejected {
        background: #f8d7da;
        color: #721c24;
    }
    
    .status-returned {
        background: #d1ecf1;
        color: #0c5460;
    }
    
    .adoption-info {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        margin-top: 1rem;
    }
    
    .info-item {
        color: #666;
    }
    
    .info-label {
        font-weight: bold;
        color: #333;
    }
    
    .empty-state {
        text-align: center;
        padding: 3rem;
        background: rgba(255, 255, 255, 0.95);
        border-radius: 15px;
        color: #999;
    }
</style>
{% endblock %}

{% block content %}
<div class="page-header">
    <h1>üìã {% if is_admin_or_volunteer %}–ó–∞—è–≤–∫–∏ –Ω–∞ —É—Å—ã–Ω–æ–≤–ª–µ–Ω–∏–µ{% else %}–ú–æ–∏ –∑–∞—è–≤–∫–∏{% endif %}</h1>
</div>

<div class="filter-section">
    <form method="get" class="filter-form">
        <label for="status">–§–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å—É:</label>
        <select id="status" name="status">
            <option value="">–í—Å–µ –∑–∞—è–≤–∫–∏</option>
            <option value="pending" {% if selected_status == 'pending' %}selected{% endif %}>–í –æ–∂–∏–¥–∞–Ω–∏–∏</option>
            <option value="approved" {% if selected_status == 'approved' %}selected{% endif %}>–û–¥–æ–±—Ä–µ–Ω–æ</option>
            <option value="rejected" {% if selected_status == 'rejected' %}selected{% endif %}>–û—Ç–∫–ª–æ–Ω–µ–Ω–æ</option>
            <option value="returned" {% if selected_status == 'returned' %}selected{% endif %}>–í–æ–∑–≤—Ä–∞—â–µ–Ω–æ</option>
        </select>
        <button type="submit" class="btn btn-primary">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
        {% if selected_status %}
            <a href="{% url 'adoption_list' %}" class="btn btn-secondary">–°–±—Ä–æ—Å–∏—Ç—å</a>
        {% endif %}
    </form>
</div>

{% if adoptions %}
    <div class="adoptions-list">
        {% for adoption in adoptions %}
            <div class="adoption-card">
                <div class="adoption-header">
                    <div class="adoption-title" style="flex: 1;">
                        {% if is_admin_or_volunteer %}
                            {{ adoption.user.username }} ‚Üí {{ adoption.animal.name }}
                        {% else %}
                            {{ adoption.animal.name }}
                        {% endif %}
                    </div>
                    <span class="status-badge status-{{ adoption.status }}">
                        {{ adoption.get_status_display }}
                    </span>
                </div>
                <div class="adoption-info">
                    {% if is_admin_or_volunteer %}
                        <div class="info-item">
                            <span class="info-label">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:</span> {{ adoption.user.username }}
                        </div>
                        {% if adoption.user.role == 'adopter' %}
                            <div class="info-item" style="background: #f8f9fa; padding: 0.8rem; border-radius: 8px; margin-top: 0.5rem;">
                                <span class="info-label">–ê–Ω–∫–µ—Ç–∞ —É—Å—ã–Ω–æ–≤–∏—Ç–µ–ª—è:</span>
                                <div style="margin-top: 0.5rem; font-size: 0.9rem;">
                                    <div>–û–ø—ã—Ç —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—è: {% if adoption.user.has_experience %}‚úÖ –î–∞{% else %}‚ùå –ù–µ—Ç{% endif %}</div>
                                    <div>–î—Ä—É–≥–∏–µ –ø–∏—Ç–æ–º—Ü—ã: {% if adoption.user.has_other_pets %}‚úÖ –î–∞{% else %}‚ùå –ù–µ—Ç{% endif %}</div>
                                    {% if adoption.user.ready_for_pet %}
                                        <div>–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –ø–∏—Ç–æ–º—Ü—É: {{ adoption.user.ready_for_pet }}</div>
                                    {% endif %}
                                </div>
                            </div>
                        {% endif %}
                    {% endif %}
                    <div class="info-item">
                        <span class="info-label">–ñ–∏–≤–æ—Ç–Ω–æ–µ:</span> {{ adoption.animal.species }} ({{ adoption.animal.name }})
                    </div>
                    <div class="info-item">
                        <span class="info-label">–ü–æ–¥–∞–Ω–æ:</span> {{ adoption.submitted_at|date:"d.m.Y H:i" }}
                    </div>
                    {% if adoption.status == 'rejected' and adoption.rejection_reason %}
                        <div class="info-item" style="color: #721c24;">
                            <span class="info-label">–ü—Ä–∏—á–∏–Ω–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è:</span> {{ adoption.rejection_reason|truncatewords:15 }}
                        </div>
                    {% elif adoption.status == 'approved' and not is_admin_or_volunteer %}
                        <div class="info-item" style="color: #155724;">
                            <span class="info-label">‚úÖ –ó–∞—è–≤–∫–∞ –æ–¥–æ–±—Ä–µ–Ω–∞!</span> –ñ–∏–≤–æ—Ç–Ω–æ–µ {{ adoption.animal.name }} —Ç–µ–ø–µ—Ä—å –≤–∞—à–µ. –°–≤—è–∂–∏—Ç–µ—Å—å —Å –Ω–∞–º–∏ –ø–æ –Ω–æ–º–µ—Ä—É <strong>+7 000 0000 0000</strong> –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π.
                        </div>
                    {% endif %}
                </div>
                {% if is_admin %}
                    <div class="admin-actions" style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid #e0e0e0;">
                        <form method="post" style="display: flex; gap: 0.5rem; flex-wrap: wrap; align-items: center;">
                            {% csrf_token %}
                            <input type="hidden" name="adoption_id" value="{{ adoption.id }}">
                            <select name="new_status" style="padding: 0.4rem; border: 1px solid #e0e0e0; border-radius: 5px;">
                                <option value="pending" {% if adoption.status == 'pending' %}selected{% endif %}>–í –æ–∂–∏–¥–∞–Ω–∏–∏</option>
                                <option value="approved" {% if adoption.status == 'approved' %}selected{% endif %}>–û–¥–æ–±—Ä–µ–Ω–æ</option>
                                <option value="rejected" {% if adoption.status == 'rejected' %}selected{% endif %}>–û—Ç–∫–ª–æ–Ω–µ–Ω–æ</option>
                            </select>
                            <input type="text" name="rejection_reason" placeholder="–ü—Ä–∏—á–∏–Ω–∞ (–µ—Å–ª–∏ –æ—Ç–∫–ª–æ–Ω—è–µ—Ç–µ)" style="flex: 1; min-width: 200px; padding: 0.4rem; border: 1px solid #e0e0e0; border-radius: 5px;">
                            <button type="submit" class="btn btn-primary" style="padding: 0.4rem 1rem;">–ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å</button>
                        </form>
                    </div>
                {% endif %}
            </div>
        {% endfor %}
    </div>
{% else %}
    <div class="empty-state">
        <p>–ó–∞—è–≤–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>
    </div>
{% endif %}
{% endblock %}

